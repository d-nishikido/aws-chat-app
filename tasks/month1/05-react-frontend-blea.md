# Task: React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º + BLEAç›£è¦–çµ±åˆ

**å®Ÿæ–½æœŸé–“**: Month 1 Week 3 (Day 1-2)  
**æ¨å®šå·¥æ•°**: 7æ™‚é–“  
**å„ªå…ˆåº¦**: é«˜  

## æ¦‚è¦

React + TypeScriptã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã€BLEAç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã¨CloudFrontã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã€WAFçµ±åˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

## å­¦ç¿’ç›®æ¨™

- Modern Reacté–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰
- TypeScript + React ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- BLEAç›£è¦–çµ±åˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã¨WAFé€£æº

## å‰ææ¡ä»¶

- BLEAåŸºç›¤æ§‹ç¯‰å®Œäº†
- Lambda + API Gatewayå®Ÿè£…å®Œäº†
- Aurora Databaseæ§‹ç¯‰å®Œäº†

## ã‚¿ã‚¹ã‚¯è©³ç´°

### Day 1: Reacté–‹ç™ºç’°å¢ƒæ§‹ç¯‰

#### 1. React + TypeScriptç’°å¢ƒæ§‹ç¯‰ (3æ™‚é–“)
- [ ] Create React App with TypeScript
- [ ] å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ è¨­è¨ˆ
- [ ] é–‹ç™ºç’°å¢ƒè¨­å®šï¼ˆESLint, Prettierï¼‰

#### 2. AWSçµ±åˆè¨­å®š (2æ™‚é–“)
- [ ] AWS Amplifyè¨­å®š
- [ ] Cognitoèªè¨¼çµ±åˆ
- [ ] API Clientè¨­å®š
- [ ] ç’°å¢ƒå¤‰æ•°ç®¡ç†

#### 3. åŸºæœ¬UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ (2æ™‚é–“)
- [ ] Material-UI/Tailwindã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] èªè¨¼ç”»é¢ã®åŸºæœ¬å®Ÿè£…
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š

### Day 2: BLEAç›£è¦–çµ±åˆã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### 1. BLEA WAFé€£æºç¢ºèª (2æ™‚é–“)
- [ ] WAFãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
- [ ] ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°æ¤œè¨¼
- [ ] æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ

#### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼å®Ÿè£… (2æ™‚é–“)
- [ ] Content Security Policyè¨­å®š
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼
- [ ] XSSå¯¾ç­–å®Ÿè£…
- [ ] CSRFå¯¾ç­–è¨­å®š

#### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç›£è¦–è¨­å®š (1æ™‚é–“)
- [ ] CloudWatch RUMçµ±åˆ
- [ ] ã‚¨ãƒ©ãƒ¼ç›£è¦–è¨­å®š
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ

### MCP ã‚µãƒ¼ãƒæ´»ç”¨

```
ğŸ’¬ "Reactã§AWSãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã€BLEAç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã¨CloudFrontã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã€
WAFçµ±åˆã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚TypeScriptã€Material-UIã€AWS Amplifyã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚"
```

## æˆæœç‰©

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ manifest.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/         # å†åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â””â”€â”€ security/
â”‚   â”œâ”€â”€ pages/             # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â””â”€â”€ ChatRoom.tsx
â”‚   â”œâ”€â”€ hooks/             # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ services/          # API ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ store/             # çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ types/             # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ utils/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ config/            # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .eslintrc.js
â””â”€â”€ .prettierrc
```

### 2. ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

#### App.tsxï¼ˆãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
```typescript
// src/App.tsx
import React from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { ThemeProvider, createTheme } from '@mui/material/styles';
import CssBaseline from '@mui/material/CssBaseline';
import { AuthProvider } from './contexts/AuthContext';
import { ChatProvider } from './contexts/ChatContext';
import { SecurityProvider } from './contexts/SecurityContext';
import ProtectedRoute from './components/auth/ProtectedRoute';
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import ChatRoom from './pages/ChatRoom';
import SecurityDashboard from './pages/SecurityDashboard';

const theme = createTheme({
  palette: {
    mode: 'light',
    primary: {
      main: '#1976d2',
    },
    secondary: {
      main: '#dc004e',
    },
  },
});

function App() {
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <AuthProvider>
        <SecurityProvider>
          <ChatProvider>
            <Router>
              <Routes>
                <Route path="/login" element={<Login />} />
                <Route
                  path="/"
                  element={
                    <ProtectedRoute>
                      <Dashboard />
                    </ProtectedRoute>
                  }
                />
                <Route
                  path="/room/:roomId"
                  element={
                    <ProtectedRoute>
                      <ChatRoom />
                    </ProtectedRoute>
                  }
                />
                <Route
                  path="/security"
                  element={
                    <ProtectedRoute requiredRole="admin">
                      <SecurityDashboard />
                    </ProtectedRoute>
                  }
                />
              </Routes>
            </Router>
          </ChatProvider>
        </SecurityProvider>
      </AuthProvider>
    </ThemeProvider>
  );
}

export default App;
```

#### AuthContextï¼ˆèªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
```typescript
// src/contexts/AuthContext.tsx
import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { Auth } from 'aws-amplify';
import { CognitoUser } from '@aws-amplify/auth';
import { SecurityService } from '../services/SecurityService';

interface User {
  id: string;
  username: string;
  email: string;
  displayName?: string;
  roles: string[];
}

interface AuthContextType {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  login: (username: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
  getCurrentUser: () => Promise<User | null>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

interface AuthProviderProps {
  children: ReactNode;
}

export const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    checkAuthState();
  }, []);

  const checkAuthState = async () => {
    try {
      const cognitoUser = await Auth.currentAuthenticatedUser();
      const userData = await transformCognitoUser(cognitoUser);
      setUser(userData);
    } catch (error) {
      console.log('User is not authenticated');
      setUser(null);
    } finally {
      setIsLoading(false);
    }
  };

  const login = async (username: string, password: string) => {
    try {
      const cognitoUser = await Auth.signIn(username, password);
      
      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
      await SecurityService.logAuthenticationEvent({
        event_type: 'login_success',
        user_identifier: username,
        source_ip: await getClientIP(),
        user_agent: navigator.userAgent
      });

      const userData = await transformCognitoUser(cognitoUser);
      setUser(userData);
    } catch (error) {
      // å¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
      await SecurityService.logAuthenticationEvent({
        event_type: 'login_failed',
        user_identifier: username,
        error_details: error.message,
        source_ip: await getClientIP(),
        user_agent: navigator.userAgent
      });
      throw error;
    }
  };

  const logout = async () => {
    try {
      await SecurityService.logAuthenticationEvent({
        event_type: 'logout',
        user_identifier: user?.username || 'unknown',
        source_ip: await getClientIP()
      });

      await Auth.signOut();
      setUser(null);
    } catch (error) {
      console.error('Error signing out:', error);
      throw error;
    }
  };

  const getCurrentUser = async (): Promise<User | null> => {
    try {
      const cognitoUser = await Auth.currentAuthenticatedUser();
      return await transformCognitoUser(cognitoUser);
    } catch (error) {
      return null;
    }
  };

  const transformCognitoUser = async (cognitoUser: CognitoUser): Promise<User> => {
    const session = await Auth.currentSession();
    const payload = session.getIdToken().payload;

    return {
      id: payload.sub,
      username: payload['cognito:username'],
      email: payload.email,
      displayName: payload.name,
      roles: payload['cognito:groups'] || []
    };
  };

  const getClientIP = async (): Promise<string> => {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    } catch (error) {
      return 'unknown';
    }
  };

  const value = {
    user,
    isAuthenticated: !!user,
    isLoading,
    login,
    logout,
    getCurrentUser
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};
```

#### SecurityServiceï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ï¼‰
```typescript
// src/services/SecurityService.ts
import { API } from 'aws-amplify';
import { CloudWatchRUM } from 'aws-sdk';

interface SecurityEvent {
  event_type: string;
  user_identifier?: string;
  source_ip?: string;
  user_agent?: string;
  error_details?: string;
  resource_accessed?: string;
  additional_data?: Record<string, any>;
}

export class SecurityService {
  private static rum: CloudWatchRUM.CloudWatchRUM;

  static async initialize() {
    // CloudWatch RUM åˆæœŸåŒ–
    this.rum = new CloudWatchRUM.CloudWatchRUM({
      region: process.env.REACT_APP_AWS_REGION,
    });
  }

  static async logAuthenticationEvent(event: SecurityEvent) {
    try {
      // APIçµŒç”±ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
      await API.post('chatapp', '/api/v1/security/events/report', {
        body: {
          event_type: event.event_type,
          event_category: 'authentication',
          severity: this.getSeverityByEventType(event.event_type),
          source_service: 'frontend',
          event_details: {
            user_identifier: event.user_identifier,
            source_ip: event.source_ip,
            user_agent: event.user_agent,
            error_details: event.error_details,
            timestamp: new Date().toISOString()
          }
        }
      });

      // CloudWatch RUM ã«ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡
      await this.recordRUMEvent(event);

    } catch (error) {
      console.error('Failed to log security event:', error);
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆå¾Œã§é€ä¿¡ï¼‰
      this.storeEventLocally(event);
    }
  }

  static async logUserActivity(activity: {
    action: string;
    resource: string;
    user_id: string;
    additional_data?: Record<string, any>;
  }) {
    await this.logAuthenticationEvent({
      event_type: 'user_activity',
      user_identifier: activity.user_id,
      resource_accessed: activity.resource,
      additional_data: {
        action: activity.action,
        ...activity.additional_data
      }
    });
  }

  static async checkSecurityHeaders(): Promise<boolean> {
    try {
      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼
      const headers = [
        'Content-Security-Policy',
        'X-Frame-Options',
        'X-Content-Type-Options',
        'Strict-Transport-Security'
      ];

      // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç¢ºèª
      const response = await fetch(window.location.href, { method: 'HEAD' });
      
      const missingHeaders = headers.filter(header => 
        !response.headers.has(header)
      );

      if (missingHeaders.length > 0) {
        await this.logAuthenticationEvent({
          event_type: 'security_header_missing',
          additional_data: {
            missing_headers: missingHeaders,
            url: window.location.href
          }
        });
        return false;
      }

      return true;
    } catch (error) {
      console.error('Security header check failed:', error);
      return false;
    }
  }

  private static getSeverityByEventType(eventType: string): string {
    const severityMap: Record<string, string> = {
      'login_failed': 'medium',
      'login_success': 'info',
      'logout': 'info',
      'user_activity': 'low',
      'security_header_missing': 'high',
      'xss_attempt': 'critical',
      'csrf_attempt': 'high'
    };

    return severityMap[eventType] || 'low';
  }

  private static async recordRUMEvent(event: SecurityEvent) {
    try {
      await this.rum.putRumEvents({
        AppMonitorName: process.env.REACT_APP_RUM_APP_MONITOR_NAME!,
        BatchId: crypto.randomUUID(),
        Events: [{
          timestamp: new Date(),
          type: 'security_event',
          details: JSON.stringify(event)
        }]
      }).promise();
    } catch (error) {
      console.error('RUM event recording failed:', error);
    }
  }

  private static storeEventLocally(event: SecurityEvent) {
    try {
      const storedEvents = JSON.parse(
        localStorage.getItem('pending_security_events') || '[]'
      );
      storedEvents.push({
        ...event,
        stored_at: new Date().toISOString()
      });
      localStorage.setItem('pending_security_events', JSON.stringify(storedEvents));
    } catch (error) {
      console.error('Failed to store event locally:', error);
    }
  }

  static async syncPendingEvents() {
    try {
      const storedEvents = JSON.parse(
        localStorage.getItem('pending_security_events') || '[]'
      );

      for (const event of storedEvents) {
        await this.logAuthenticationEvent(event);
      }

      localStorage.removeItem('pending_security_events');
    } catch (error) {
      console.error('Failed to sync pending events:', error);
    }
  }
}
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

#### CSPè¨­å®šï¼ˆpublic/index.htmlï¼‰
```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <meta http-equiv="Content-Security-Policy" 
        content="
          default-src 'self';
          script-src 'self' 'unsafe-inline' https://cognito-idp.ap-northeast-1.amazonaws.com;
          style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
          font-src 'self' https://fonts.gstatic.com;
          img-src 'self' data: https:;
          connect-src 'self' https://*.amazonaws.com https://*.amplifyapp.com;
          frame-ancestors 'none';
        ">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  
  <title>Chat App - BLEA Secure</title>
</head>
<body>
  <div id="root"></div>
</body>
</html>
```

## æ¤œè¨¼é …ç›®

- [ ] React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«èµ·å‹•ã™ã‚‹
- [ ] TypeScript ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] Cognitoèªè¨¼ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] AWS APIå‘¼ã³å‡ºã—ãŒæˆåŠŸã™ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒé©ç”¨ã•ã‚Œã‚‹
- [ ] CSPé•åãŒç™ºç”Ÿã—ãªã„
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜éŒ²ã•ã‚Œã‚‹
- [ ] CloudWatch RUM ãŒå‹•ä½œã™ã‚‹

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

- [ ] XSSå¯¾ç­–å®Ÿè£…
- [ ] CSRFå¯¾ç­–è¨­å®š
- [ ] ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜
- [ ] æ©Ÿå¯†æƒ…å ±ã®é©åˆ‡ãªå–ã‚Šæ‰±ã„
- [ ] ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®é©åˆ‡ãªãƒã‚¹ã‚­ãƒ³ã‚°
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®é©åˆ‡ãªå®Ÿè£…

## æ¬¡ã®ã‚¿ã‚¹ã‚¯ã¸ã®å¼•ãç¶™ãäº‹é …

- React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ 
- èªè¨¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…çŠ¶æ³
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š
- ç›£è¦–ãƒ»ãƒ­ã‚°çµ±åˆçŠ¶æ³

## å‚è€ƒè³‡æ–™

- [React TypeScript](https://react-typescript-cheatsheet.netlify.app/)
- [AWS Amplify React](https://docs.amplify.aws/lib/auth/getting-started/q/platform/js/)
- [Material-UI](https://mui.com/material-ui/getting-started/overview/)
- [CloudWatch RUM](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-RUM.html)